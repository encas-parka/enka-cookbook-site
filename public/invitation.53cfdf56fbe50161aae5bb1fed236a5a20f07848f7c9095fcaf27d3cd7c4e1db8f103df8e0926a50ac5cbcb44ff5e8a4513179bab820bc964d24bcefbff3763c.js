(()=>{var a={endpoint:"https://cloud.appwrite.io/v1",projectId:"689725820024e81781b7",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3"},collections:{main:"main",purchases:"purchases",products:"products"}},o=null,p=null,f=null,m=null,y=null,C=null;function V(e=50,t=100){return new Promise((n,i)=>{let r=0;function l(){r++,window.Appwrite&&window.Appwrite.Client&&window.Appwrite.Account?n():r>=e?(console.error("[Appwrite Client] SDK Appwrite non charg\xE9 apr\xE8s le nombre maximum de tentatives"),i(new Error("Le SDK Appwrite n'a pas pu \xEAtre charg\xE9."))):setTimeout(l,t)}l()})}async function u(){return o&&p&&f&&m?{client:o,account:p,functions:f,databases:m}:C||(C=(async()=>{try{console.log("[Appwrite Client] D\xE9but de l'initialisation"),await V();let{Client:e,Account:t,Functions:n,Databases:i,Teams:r}=window.Appwrite;return o=new e().setEndpoint(a.endpoint).setProject(a.projectId),p=new t(o),f=new n(o),m=new i(o),y=new r(o),console.log("[Appwrite Client] Initialisation termin\xE9e avec succ\xE8s"),{client:o,account:p,functions:f,databases:m,teams:y}}catch(e){throw console.error("[Appwrite Client] Erreur lors de l'initialisation:",e),o=null,p=null,f=null,m=null,y=null,C=null,e}})(),C)}async function L(){return await u()}async function c(){return p||await u(),p}async function D(){return y||await u(),y}async function N(){return f||await u(),f}async function R(){return m||await u(),m}function k(){return{APPWRITE_ENDPOINT:a.endpoint,APPWRITE_PROJECT_ID:a.projectId,APPWRITE_FUNCTION_ID:a.functions.cmsAuth,ACCESS_REQUEST_FUNCTION_ID:a.functions.accessRequest,APPWRITE_CONFIG:a}}function z(){return!!(o&&p&&f&&m&&y)}function x(){let e=localStorage.getItem("sveltia-cms.user");if(!e)return null;try{let t=JSON.parse(e);return t.token&&typeof t.token=="string"&&t.token.trim()!==""?t:(localStorage.removeItem("sveltia-cms.user"),null)}catch{return localStorage.removeItem("sveltia-cms.user"),null}}function I(){return x()!==null}async function O(){try{return await(await c()).get(),!0}catch{return!1}}async function j(){try{let e=await c(),t=await e.get();if(!t||!t.$id)return!1;let n=await e.getSession("current");if(!n||!n.$id)return!1;let i=new Date,r=new Date(n.expire);return!(i>=r)}catch(e){return console.error("Error checking connection:",e),!1}}async function F(){try{return(await(await c()).get()).emailVerification||!1}catch{return!1}}async function B(e=null){try{let t=await c(),n=e||`${window.location.origin}/verify-email`;await t.createVerification(n)}catch(t){throw console.error("[AppwriteClient] Erreur lors de l'envoi de l'email de v\xE9rification:",t),t}}async function M(e,t){try{await(await c()).updateVerification(e,t)}catch(n){throw console.error("[AppwriteClient] Erreur lors de la v\xE9rification d'email:",n),n}}function q(){return localStorage.getItem("appwrite-user-email")}function G(){return localStorage.getItem("appwrite-user-name")}function Z(){return localStorage.getItem("email-verification-status")}function _(){localStorage.removeItem("sveltia-cms.user"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("email-verification-status")}async function W(e){console.log(`[Appwrite Client] Validation des donn\xE9es pour l'\xE9v\xE9nement ${e}`);let t=await fetch(`/evenements/${e}/ingredients_aw/index.json`);if(!t.ok)throw new Error(`Impossible de r\xE9cup\xE9rer les donn\xE9es de l'\xE9v\xE9nement: ${t.status}`);let n=await t.json();console.log("[Appwrite Client] Donn\xE9es de l'\xE9v\xE9nement r\xE9cup\xE9r\xE9es:",n);let{account:i,databases:r}=await u(),l=await i.get();console.log(`[Appwrite Client] Utilisateur authentifi\xE9: ${l.$id}`);try{return await r.getDocument(a.databaseId,a.collections.main,e),console.log(`[Appwrite Client] L'\xE9v\xE9nement ${e} existe d\xE9j\xE0 dans main`),window.location.href=`/sv_products/?listId=${e}`,null}catch(d){if(d.code!==404)throw d}let s=window.__HUGO_PARAMS__?.listContentHash;if(!s)throw new Error("Le hash du contenu n'est pas d\xE9fini");return{eventData:n,user:l,contentHash:s}}async function H(e,t,n,i){console.log(`[Appwrite Client] Appel de la fonction serveur pour ${e}`);let r=a.functions.createProductList,{functions:l}=await u();try{let s=await l.createExecution(r,JSON.stringify({eventId:e,eventData:t,userId:n,contentHash:i}),!0,"/","GET",{});console.log("[Appwrite Client] Ex\xE9cution d\xE9marr\xE9e en mode asynchrone:",s);let d=s.$id;return console.log(`[Appwrite Client] Execution ID: ${d}`),console.log("[Appwrite Client] Ex\xE9cution async d\xE9marr\xE9e pour 300+ ingr\xE9dients - pas de polling"),{success:!0,eventId:e,executionId:d,message:"Traitement d\xE9marr\xE9 en arri\xE8re-plan (300+ ingr\xE9dients)",isAsync:!0}}catch(s){throw console.error("[Appwrite Client] Erreur lors de l'appel fonction:",s),s}}async function J(e){try{console.log(`[Appwrite Client] D\xE9but de la cr\xE9ation pour l'\xE9v\xE9nement ${e}`);let t=await W(e);if(!t)return;let{eventData:n,user:i,contentHash:r}=t;console.log("[Appwrite Client] Donn\xE9es valid\xE9es, appel de la fonction");let l=await H(e,n,i.$id,r);console.log("[Appwrite Client] Op\xE9ration r\xE9ussie, redirection vers la liste"),window.location.href=`/sv_products/?listId=${e}`}catch(t){throw console.error("[Appwrite Client] Erreur lors de la cr\xE9ation:",t.message),t.message.includes("already_exists")?new Error("Cette liste de produits existe d\xE9j\xE0. Veuillez r\xE9essayer avec un ID diff\xE9rent."):t.message.includes("transaction_limit_exceeded")?new Error("Limite de transactions d\xE9pass\xE9e. Veuillez r\xE9duire le nombre d'ingr\xE9dients ou r\xE9essayer plus tard."):t}}async function K(e){try{let{databases:t}=await u();return!!await t.getDocument("689d15b10003a5a13636","main",e)}catch(t){return t.code===404||console.error("[Appwrite Client] Erreur lors de la v\xE9rification du main group existant:",t),!1}}async function Q(){try{_(),await(await c()).deleteSession("current")}catch(e){console.warn("[Appwrite Client] Erreur lors de la d\xE9connexion Appwrite (peut-\xEAtre d\xE9j\xE0 d\xE9connect\xE9):",e)}}function X(e,t,n){localStorage.setItem("appwrite-user-email",e),localStorage.setItem("appwrite-user-name",t),localStorage.setItem("sveltia-cms.user",JSON.stringify(n))}function Y(e,t,n,i={}){let{onConnect:r,onDisconnect:l,onError:s}=i;if(!o)return console.error("Impossible de s'abonner : le client Appwrite n'est pas encore initialis\xE9."),s?.({message:"Client Appwrite non initialis\xE9"}),()=>{};let d=e.map(g=>{let v=a.collections[g];return v?`databases.${a.databaseId}.collections.${v}.documents`:(console.warn(`[Appwrite Client] Nom de collection inconnu dans la configuration: ${g}`),null)}).filter(Boolean);console.log("[Appwrite Client] Abonnement aux canaux en cours...",d);try{let g=o.subscribe(d,v=>{console.log("[Appwrite Client] R\xE9ception temps r\xE9el:",v),n(v)});return r&&setTimeout(()=>{console.log("[Appwrite Client] Connexion temps r\xE9el \xE9tablie"),r()},50),g}catch(g){return console.error("[Appwrite Client] Erreur lors de la souscription temps r\xE9el:",g),s?.(g),()=>{}}}typeof window<"u"&&(window.AppwriteClient={getAppwriteClients:L,getAccount:c,getFunctions:N,getDatabases:R,getConfig:k,isInitialized:z,initializeAppwrite:u,getLocalCmsUser:x,isAuthenticatedCms:I,isAuthenticatedAppwrite:O,isConnectedAppwrite:j,getUserEmail:q,getUserName:G,clearAuthData:_,setAuthData:X,logoutGlobal:Q,isEmailVerified:F,sendVerificationEmail:B,verifyEmail:M,getLocalEmailVerificationStatus:Z,createCollaborativeProductsListFromEvent:J,checkExistingMainGroup:K,subscribeToCollections:Y});var ee="689bf6fe0006627d8959",$=document.getElementById("invitation-auth-loading"),P=document.getElementById("invitation-auth-denied"),T=document.getElementById("invitation-auth-granted"),S=document.getElementById("invitation-form"),te=document.getElementById("invitation-email"),A=document.getElementById("invitation-button"),w=document.getElementById("invitation-error-message"),E=document.getElementById("invitation-success-message"),h=A?.querySelector(".spinner-border");function b(e){$&&($.style.display=e==="loading"?"block":"none"),P&&(P.style.display=e==="denied"?"block":"none"),T&&(T.style.display=e==="granted"?"block":"none")}S&&S.addEventListener("submit",async e=>{e.preventDefault(),w&&(w.style.display="none"),E&&(E.style.display="none"),h&&(h.style.display="inline-block"),A&&(A.disabled=!0);let t=te.value.trim();if(!ne(t)){w&&(w.textContent=`L'adresse email "${t}" n'est pas valide. Veuillez v\xE9rifier le format de l'email (exemple@domaine.com).`,w.style.display="block"),h&&(h.style.display="none"),A&&(A.disabled=!1);return}try{let i=await(await c()).get();await(await D()).createMembership(ee,["owner"],t,void 0,void 0,`${window.location.origin}/accept-invitation`),E&&(E.textContent=`L'invitation a \xE9t\xE9 envoy\xE9e avec succ\xE8s \xE0 ${t} !`,E.style.display="block"),S.reset()}catch(n){console.error("Erreur lors de l'envoi de l'invitation:",n);let i="Une erreur est survenue.";n.code===401?i="Vous n'avez pas la permission d'inviter des membres. Seuls les propri\xE9taires de l'\xE9quipe le peuvent.":n.code===409?i="Cette personne est d\xE9j\xE0 membre de l'\xE9quipe ou a d\xE9j\xE0 une invitation en attente.":n.message&&(i=n.message),w&&(w.textContent=i,w.style.display="block")}finally{h&&(h.style.display="none"),A&&(A.disabled=!1)}});function ne(e){if(!e||e.length===0||(e=e.trim(),/\s/.test(e))||e.length<5||e.length>254)return!1;let t=/^[a-zA-Z0-9]([a-zA-Z0-9._+-]*[a-zA-Z0-9])?@[a-zA-Z0-9]([a-zA-Z0-9.-]*[a-zA-Z0-9])?\.[a-zA-Z]{2,}$/;return e.includes("..")?!1:t.test(e)}async function U(){console.log("[Appwrite Client] Initialisation du client Appwrite"),b("loading");try{if(!I()){b("denied");return}try{let e=await c();await e.get(),console.log("[Appwrite Client] R\xE9cup\xE9ration du compte Appwrite r\xE9ussie",e),b("granted")}catch{b("denied")}}catch(e){console.error("Erreur inattendue au chargement de la page d'invitation:",e),b("denied")}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U):U();})();
