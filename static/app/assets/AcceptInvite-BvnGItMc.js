import{d as pe,X as ue,A as t,F as H,y as o,m as e,V as Q,ae as me,G as N,J as fe,Y as be,v as b,K as y,h as n,P as ge,b as c,c as _e,j as Z,k as C,g as r,w as P,x as $,B as he,C as ee,o as l,W as B,T as S,a8 as we}from"./appwrite-_5e16uFI.js";import{n as te,a as xe}from"./index-DPkaPVhg.js";import{T as Ie}from"./icons-BII4FnZr.js";var ye=b(`<span class="loading loading-spinner loading-lg text-primary mx-auto"></span> <p class="text-base-content/70 mt-4">V√©rification de l'invitation...</p>`,1),ke=b(`<!> <h2 class="text-error text-xl font-bold">Oups !</h2> <p class="py-4"> </p> <button class="btn btn-ghost">Retour √† l'accueil</button>`,1),Ae=b('<div class="alert alert-warning mb-4" role="alert"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <span><strong>Information :</strong> </span></div>'),Ve=b('<span class="loading loading-spinner loading-xs"></span>'),Le=b(`<div class="mb-2 text-4xl">üëã</div> <h2 class="card-title justify-center text-2xl">Bienvenue !</h2> <p class="text-base-content/70 mb-6 text-sm">Votre invitation est valid√©e. <br/> Veuillez d√©finir un mot de passe.</p> <!> <label class="w-full text-left"><div class="label"><span class="label-text">Votre Pseudo / Nom</span> <span class="label-text-alt text-error">*</span></div> <input type="text" class="input w-full" required maxlength="25"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Nouveau mot de passe</span></div> <input type="password" placeholder="Minimum 8 caract√®res" class="input w-full"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Confirmer le mot de passe</span></div> <input type="password" placeholder="Ressaisissez le mot de passe" class="input w-full"/></label> <div class="card-actions mt-6"><button class="btn btn-primary w-full"><!> Terminer l'inscription</button></div>`,1),ze=b('<div class="bg-base-200 flex h-full items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body text-center"><!></div></div></div>');function je(ae,se){pe(se,!0);let d=o(!0),m=o("verifying"),R=o(""),D=o(!1),F=o(""),g=o(""),T=o(""),v=o(""),_=o(""),k=o("");ue(async()=>{if(t(_,H.search.userId||"",!0),t(k,H.search.teamId||"",!0),!e(_)||!e(k)){t(m,"error"),t(R,"Lien d'invitation incomplet ou invalide."),t(d,!1);return}try{console.log("[AcceptInvite] Initialisation...",{userId:e(_),teamId:e(k)});const{client:a,account:i}=await Q(),p=await me(e(_),e(k));p.membershipRevoked&&(t(D,!0),t(F,p.teamName||"l'√©quipe",!0)),console.log("[AcceptInvite] Token re√ßu, cr√©ation session..."),await i.createSession({userId:e(_),secret:p.token});const u=await i.get();if(console.log("[AcceptInvite] Connect√© en tant que :",u.name),t(v,u.name,!0),u.passwordUpdate){N("/dashboard");return}t(m,"set-password")}catch(a){console.error("[AcceptInvite] Erreur validation:",a),t(m,"error"),t(R,a.message||"Ce lien d'invitation est invalide.",!0)}finally{t(d,!1)}});async function re(){if(!e(v)||e(v).trim().length===0){alert("Veuillez saisir votre pseudo / nom.");return}if(e(g).length<8){alert("Le mot de passe doit faire au moins 8 caract√®res.");return}if(e(g)!==e(T)){alert("Les mots de passe ne correspondent pas.");return}t(d,!0);try{const{client:a,account:i}=await Q();await i.updatePassword({password:e(g)}),e(v)&&await i.updateName({name:e(v)}),console.log("[AcceptInvite] Mot de passe d√©fini, rafra√Æchissement auth...");const{globalState:p}=await we(async()=>{const{globalState:u}=await import("./appwrite-_5e16uFI.js").then(j=>j.b9);return{globalState:u}},[]);await p.refreshAuthAfterLogin(),console.log("[AcceptInvite] Auth rafra√Æchie, redirection..."),N("/dashboard")}catch(a){console.error("[AcceptInvite] Erreur finalisation:",a),alert("Erreur : "+a.message),t(d,!1)}}fe(()=>{te.setConfig({title:"Rejoindre l'√©quipe"})}),be(()=>{te.reset()});var A=ze(),O=n(A),G=n(O),ne=n(G);{var le=a=>{var i=ye();ee(2),c(a,i)},ie=a=>{var i=Z(),p=C(i);{var u=f=>{var h=ke(),V=C(h);Ie(V,{class:"text-error mb-2 size-7"});var w=r(V,4),x=n(w,!0);l(w);var L=r(w,2);L.__click=()=>N("/"),P(()=>$(x,e(R))),c(f,h)},j=f=>{var h=Z(),V=C(h);{var w=x=>{var L=Le(),J=r(C(L),6);{var oe=s=>{var I=Ae(),Y=r(n(I),2),ve=r(n(Y));l(Y),l(I),P(()=>$(ve,` Votre acc√®s √† ${e(F)??""} a √©t√© r√©voqu√©.
              Vous pouvez tout de m√™me cr√©er votre compte et vous connecter.`)),c(s,I)};y(J,s=>{e(D)&&s(oe)})}var q=r(J,2),K=r(n(q),2);B(K),l(q);var E=r(q,2),U=r(n(E),2);B(U),l(E);var M=r(E,2),W=r(n(M),2);B(W),l(M);var X=r(M,2),z=n(X);z.__click=re;var ce=n(z);{var de=s=>{var I=Ve();c(s,I)};y(ce,s=>{e(d)&&s(de)})}ee(),l(z),l(X),P(()=>z.disabled=e(d)),S(K,()=>e(v),s=>t(v,s)),S(U,()=>e(g),s=>t(g,s)),S(W,()=>e(T),s=>t(T,s)),c(x,L)};y(V,x=>{e(m)==="set-password"&&x(w)},!0)}c(f,h)};y(p,f=>{e(m)==="error"?f(u):f(j,!1)},!0)}c(a,i)};y(ne,a=>{e(d)&&e(m)!=="set-password"?a(le):a(ie,!1)})}l(G),l(O),l(A),ge(3,A,()=>xe),c(ae,A),_e()}he(["click"]);export{je as default};
