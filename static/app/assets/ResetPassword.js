import{d as he,X as ye,A as t,F as Z,y as m,m as e,v as f,g as n,h as a,K as h,b as d,c as ke,j as Le,k as y,w as E,x as U,B as Re,G as $,o as s,C as j,W as ee,S as je,T as ae,V as Ve,U as Ce}from"./appwrite.js";import{K as Ie,g as se,x as te,G as Me,H as Pe}from"./icons.js";var ze=f('<p class="text-base-content/70 mt-2">Entrez votre nouveau mot de passe</p>'),qe=f('<div class="flex flex-col items-center py-8"><!> <p class="text-base-content/70 mt-4">Vérification du lien...</p></div>'),Ae=f('<div role="alert" class="alert alert-error max-md:alert-vertical mt-4"><!> <span> </span></div> <div class="card-actions mt-6 justify-center"><button class="btn btn-primary">Retour à la connexion</button></div>',1),Ee=f('<div role="alert" class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Ke=f('<div role="alert" class="alert alert-success max-md:alert-vertical mb-4"><!> <span> </span></div> <p class="text-base-content/70 text-center">Vous allez être redirigé...</p>',1),Te=f("<!> Réinitialisation en cours...",1),Ge=f(`<form class="space-y-4 svelte-ybl9gg"><fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Nouveau mot de passe</span></legend> <input id="new-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/> <p class="label text-base-content/50">Minimum 8 caractères</p></fieldset> <fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Confirmer le mot de passe</span></legend> <input id="confirm-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/></fieldset> <div class=" mt-6 svelte-ybl9gg"><button type="submit" class="btn btn-primary btn-block"><!></button></div></form> <div class="card-actions mt-4 justify-center"><button class="btn btn-ghost btn-sm"><!> Retour à l'acceuil</button></div>`,1),Be=f("<!> <!>",1),De=f('<div class="bg-base-200 flex h-full items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body"><div class="text-center"><div class="mb-4 flex justify-center"><div class="bg-primary/10 rounded-full p-4"><!></div></div> <h2 class="card-title justify-center text-2xl">Réinitialisation du mot de passe</h2> <!></div> <!></div></div></div>');function Ne(re,ie){he(ie,!0);let b=m(!1),o=m(""),K=m(""),g=m(""),V=m(""),k=m(!1),T=m(!0),C=m(""),I=m("");ye(()=>{t(C,Z.search.userId||"",!0),t(I,Z.search.secret||"",!0),le()});async function le(){if(!e(C)||!e(I)){t(o,"Lien de réinitialisation invalide ou manquant."),t(k,!1),t(T,!1);return}t(k,!0),t(T,!1)}async function ne(i){if(i.preventDefault(),!e(C)||!e(I)||!e(k)){t(o,"Lien de réinitialisation invalide.");return}if(!e(g)||!e(V)){t(o,"Veuillez remplir tous les champs");return}if(e(g)!==e(V)){t(o,"Les mots de passe ne correspondent pas.");return}if(e(g).length<8){t(o,"Le mot de passe doit contenir au moins 8 caractères.");return}t(b,!0),t(o,"");try{const{account:r}=await Ve();await r.updateRecovery({userId:e(C),secret:e(I),password:e(g)}),t(K,"Mot de passe réinitialisé avec succès !"),setTimeout(()=>{$("/dashboard")},3e3)}catch(r){console.error("Erreur réinitialisation:",r),r.response?.code===401||r.message?.includes("Invalid secret")?t(o,"Ce lien est invalide ou a expiré. Veuillez refaire une demande."):t(o,r.message||"Erreur lors de la réinitialisation",!0)}finally{t(b,!1)}}function W(){$("/")}var G=De(),X=a(G),J=a(X),B=a(J),D=a(B),O=a(D),oe=a(O);Ie(oe,{class:"text-primary h-8 w-8"}),s(O),s(D);var de=n(D,4);{var ve=i=>{var r=ze();d(i,r)};h(de,i=>{e(k)&&i(ve)})}s(B);var ce=n(B,2);{var ue=i=>{var r=qe(),F=a(r);se(F,{class:"text-primary h-12 w-12 animate-spin"}),j(2),s(r),d(i,r)},pe=i=>{var r=Le(),F=y(r);{var me=w=>{var L=Ae(),x=y(L),M=a(x);te(M,{class:"h-6 w-6 shrink-0"});var P=n(M,2),H=a(P,!0);s(P),s(x);var z=n(x,2),l=a(z);l.__click=W,s(z),E(()=>U(H,e(o))),d(w,L)},fe=w=>{var L=Be(),x=y(L);{var M=l=>{var u=Ee(),v=a(u);te(v,{class:"h-6 w-6 shrink-0"});var p=n(v,2),_=a(p,!0);s(p),s(u),E(()=>U(_,e(o))),d(l,u)};h(x,l=>{e(o)&&l(M)})}var P=n(x,2);{var H=l=>{var u=Ke(),v=y(u),p=a(v);Me(p,{class:"h-6 w-6 shrink-0"});var _=n(p,2),R=a(_,!0);s(_),s(v),j(2),E(()=>U(R,e(K))),d(l,u)},z=l=>{var u=Ge(),v=y(u),p=a(v),_=n(a(p),2);ee(_),j(2),s(p);var R=n(p,2),N=n(a(R),2);ee(N),s(R);var Q=n(R,2),S=a(Q),_e=a(S);{var be=c=>{var A=Te(),xe=y(A);se(xe,{class:"mr-2 h-4 w-4 animate-spin"}),j(),d(c,A)},ge=c=>{var A=Ce("Réinitialiser le mot de passe");d(c,A)};h(_e,c=>{e(b)?c(be):c(ge,!1)})}s(S),s(Q),s(v);var Y=n(v,2),q=a(Y);q.__click=W;var we=a(q);Pe(we,{class:"mr-1 h-4 w-4"}),j(),s(q),s(Y),E(()=>{_.disabled=e(b),N.disabled=e(b),S.disabled=e(b),q.disabled=e(b)}),je("submit",v,ne),ae(_,()=>e(g),c=>t(g,c)),ae(N,()=>e(V),c=>t(V,c)),d(l,u)};h(P,l=>{e(K)?l(H):l(z,!1)})}d(w,L)};h(F,w=>{e(k)?w(fe,!1):w(me)},!0)}d(i,r)};h(ce,i=>{e(T)?i(ue):i(pe,!1)})}s(J),s(X),s(G),d(re,G),ke()}Re(["click"]);export{Ne as default};
